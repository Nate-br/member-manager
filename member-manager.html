<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Member Savings Manager | Vision for a Better Life</title>

    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        /* --- ALL YOUR ORIGINAL CSS IS HERE AND UNCHANGED --- */
        :root {
            --primary: #3498db;
            --secondary: #2c3e50;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
            --gray: #95a5a6;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Power Geez Unicode 1', 'Noto Sans Ethiopic', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); color: #333; line-height: 1.6; min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        @font-face { font-family: 'Power Geez Unicode 1'; src: local('Power Geez Unicode 1'), local('PowerGeezUnicode1'); }
        .admin-login { display: flex; justify-content: center; align-items: center; min-height: 80vh; }
        .login-card { background: #fff; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); max-width: 420px; width: 100%; overflow: hidden; text-align: center; }
        .login-header { background: var(--secondary); color: #fff; padding: 28px 20px; }
        .admin-logo { width: 90px; height: 90px; border-radius: 50%; overflow: hidden; margin: 0 auto 12px; box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2); }
        .admin-logo img { width: 100%; height: 100%; object-fit: cover; }
        .login-body { padding: 26px; }
        .login-card .form-group { margin-bottom: 18px; text-align: left; }
        .login-card .form-control { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 6px; }
        .login-card .btn { width: 100%; padding: 12px; }
        .main-app { display: none; }
        header { background: #fff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); padding: 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo-icon { width: 70px; height: 70px; border-radius: 50%; overflow: hidden; flex-shrink: 0; }
        .logo-icon img { width: 100%; height: 100%; object-fit: cover; }
        .logo-text h1 { font-size: 1.8rem; color: var(--secondary); }
        .logo-text p { color: var(--gray); font-size: .9rem; }
        .header-actions { display: flex; gap: 12px; flex-wrap: wrap; }
        .main-content { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }
        footer { text-align: center; padding: 18px; color: var(--gray); font-size: .9rem; margin-top: 20px; }
        .btn { padding: 10px 18px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: all .25s ease; text-decoration: none; }
        .btn-primary { background: var(--primary); color: #fff; } .btn-success { background: var(--success); color: #fff; } .btn-warning { background: var(--warning); color: #fff; } .btn-danger { background: var(--danger); color: #fff; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15); }
        .btn:disabled { background: var(--gray); cursor: not-allowed; transform: none; box-shadow: none; }
        .card { background: #fff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); padding: 25px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; margin-bottom: 20px; padding-bottom: 12px; border-bottom: 1px solid #eee; }
        .card-title { font-size: 1.3rem; color: var(--secondary); display: flex; align-items: center; gap: 10px; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--dark); }
        .form-control { width: 100%; padding: 12px 14px; border: 1px solid #ddd; border-radius: 6px; font-size: 1rem; transition: all 0.2s ease; }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2); }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .form-buttons { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; }
        .file-upload { border: 2px dashed #ddd; border-radius: 8px; padding: 26px; text-align: center; background: #f9f9f9; cursor: pointer; transition: border-color 0.2s ease, background-color 0.2s ease; }
        .file-upload:hover { border-color: var(--primary); background-color: #f0f8ff; }
        #fileInput { display: none; }
        .search-bar { flex-grow: 1; max-width: 300px; }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #fff; border-radius: 10px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); padding: 20px; display: flex; align-items: center; gap: 16px; }
        .stat-icon { width: 56px; height: 56px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 22px; flex-shrink: 0; }
        .stat-primary { background: rgba(52, 152, 219, 0.1); color: var(--primary); } .stat-success { background: rgba(39, 174, 96, 0.1); color: var(--success); } .stat-warning { background: rgba(243, 156, 18, 0.1); color: var(--warning); }
        .tabs { display: flex; gap: 6px; margin-bottom: 20px; border-bottom: 1px solid #eee; }
        .tab { padding: 10px 16px; cursor: pointer; border-bottom: 3px solid transparent; transition: all 0.2s ease; }
        .tab.active { border-bottom-color: var(--primary); color: var(--primary); font-weight: 600; }
        .tab-content { display: none; } .tab-content.active { display: block; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 14px 10px; text-align: left; border-bottom: 1px solid #eee; white-space: nowrap; }
        th:first-child, td:first-child { padding-left: 15px; width: 1%; }
        th { background: #f8f9fa; font-weight: 600; color: var(--dark); }
        .action-buttons { display: flex; gap: 6px; }
        .action-buttons .btn { padding: 6px 10px; background-color: transparent; }
        .action-buttons .edit-btn { color: var(--primary); } .action-buttons .delete-btn { color: var(--danger); }
        .empty-state { text-align: center; color: var(--gray); padding: 40px 10px; }
        .empty-state i { font-size: 3rem; margin-bottom: 1rem; display: block; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); display: none; justify-content: center; align-items: center; z-index: 1000; }
        .modal-overlay.show { display: flex; }
        .modal-content { background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2); width: 90%; max-width: 500px; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        .modal-title { font-size: 1.5rem; color: var(--secondary); }
        .modal-close-btn { background: transparent; border: none; font-size: 1.5rem; cursor: pointer; color: var(--gray); }
        .notification { position: fixed; top: 20px; right: 20px; padding: 14px 20px; border-radius: 6px; color: #fff; font-weight: 600; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); transform: translateX(120%); transition: transform .4s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 1001; }
        .notification.show { transform: translateX(0); }
        .notification-success { background: var(--success); } .notification-error { background: var(--danger); } .notification-warning { background: var(--warning); }
        .amharic-text { font-family: 'Power Geez Unicode 1', 'Noto Sans Ethiopic', sans-serif; }
        @media (max-width: 992px) { .main-content { grid-template-columns: 1fr; } }
        @media (max-width: 768px) { body { padding: 10px; } header { flex-direction: column; align-items: flex-start; } .form-row { grid-template-columns: 1fr; } }
    </style>
</head>
<body>

    <!-- Admin Login Section -->
    <div class="admin-login" id="adminLogin">
        <div class="login-card">
            <div class="login-header">
                <div class="admin-logo"><img src="images/logo.png" alt="Logo" /></div>
                <h2>Admin Login</h2><p>Vision for a Better Life</p>
            </div>
            <div class="login-body">
                <form id="adminForm">
                    <div class="form-group"><label for="adminUsername">Username</label><input type="text" id="adminUsername" class="form-control" placeholder="admin" required /></div>
                    <div class="form-group"><label for="adminPassword">Password</label><input type="password" id="adminPassword" class="form-control" placeholder="password" required /></div>
                    <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Login</button>
                </form>
                <!-- LOGIN HINT REMOVED HERE -->
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div class="main-app" id="mainApp">
        <div class="container">
            <header>
                <div class="logo">
                    <div class="logo-icon"><img src="images/logo.png" alt="Logo" /></div>
                    <div class="logo-text"><h1>Member Savings Manager</h1><p>Vision for a Better Life - Savings & Loan Association</p></div>
                </div>
                <div class="header-actions">
                    <button class="btn btn-primary" id="addMemberBtn"><i class="fas fa-plus"></i> Add Member</button>
                    <button class="btn btn-success" id="exportBtn"><i class="fas fa-file-export"></i> Export Data</button>
                    <button class="btn btn-warning" id="settingsBtn"><i class="fas fa-cog"></i> Settings</button>
                    <button class="btn btn-danger" id="logoutAdminBtn"><i class="fas fa-sign-out-alt"></i> Logout</button>
                </div>
            </header>

            <div class="stats-container">
                <div class="stat-card"><div class="stat-icon stat-primary"><i class="fas fa-users"></i></div><div><h3 id="totalMembers">0</h3><p>Total Members</p></div></div>
                <div class="stat-card"><div class="stat-icon stat-success"><i class="fas fa-coins"></i></div><div><h3 id="totalSavingsStat">0</h3><p>Total Savings (ETB)</p></div></div>
                <div class="stat-card"><div class="stat-icon stat-warning"><i class="fas fa-chart-line"></i></div><div><h3 id="avgSavings">0</h3><p>Avg. Savings (ETB)</p></div></div>
            </div>

            <main class="main-content">
                <!-- Left Card: Add/Edit Member Form -->
                <div class="card">
                    <div class="card-header"><h2 class="card-title"><i class="fas fa-user-plus"></i> Add / Edit Member</h2></div>
                    <div class="tabs">
                        <div class="tab active" data-tab="manual">Manual Entry</div>
                        <div class="tab" data-tab="excel">Excel Import</div>
                    </div>

                    <!-- Manual Entry Tab -->
                    <div class="tab-content active" id="manual-tab">
                        <form id="manualEntryForm">
                            <input type="hidden" id="editingMemberId">
                            <div class="form-row">
                                <div class="form-group"><label for="memberId">Member ID</label><input type="text" id="memberId" class="form-control" placeholder="Enter member ID" required /></div>
                                <div class="form-group"><label for="fullName">Full Name</label><input type="text" id="fullName" class="form-control amharic-text" placeholder="Enter full name" required /></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="phoneNumber">Phone Number</label><input type="tel" id="phoneNumber" class="form-control" placeholder="+2519..." required /></div>
                                <div class="form-group"><label for="chatId">Telegram Chat ID</label><input type="text" id="chatId" class="form-control" placeholder="Numeric ID" /></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group"><label for="shareAmount">Share Amount (ETB)</label><input type="number" id="shareAmount" class="form-control" placeholder="Enter share amount" min="0" step="0.01" required /></div>
                                <div class="form-group"><label for="entranceFee">Entrance Fee (ETB)</label><input type="number" id="entranceFee" class="form-control" placeholder="Enter entrance fee" min="0" step="0.01" required /></div>
                            </div>
                            <div class="form-row">
                                <div class="form-group" style="grid-column: 1 / -1;"><label for="totalSavings">Total Savings (ETB)</label><input type="number" id="totalSavings" class="form-control" placeholder="Calculated automatically" readonly /></div>
                            </div>
                            <div class="form-group"><label for="date">Date</label><input type="date" id="date" class="form-control" required /></div>
                            <div class="form-buttons">
                                <button type="submit" class="btn btn-success"><i class="fas fa-save"></i> Save Member</button>
                                <button type="button" class="btn btn-danger" id="cancelEditBtn" style="display:none;"><i class="fas fa-times"></i> Cancel Edit</button>
                            </div>
                        </form>
                    </div>

                    <!-- Excel Import Tab -->
                    <div class="tab-content" id="excel-tab">
                        <div class="file-upload" id="dropZone"><i class="fas fa-file-excel"></i><p>Drag & Drop your Excel file here or</p><button type="button" class="btn btn-primary"><i class="fas fa-folder-open"></i> Browse Files</button><small>Supported formats: .xlsx, .xls</small><input type="file" id="fileInput" accept=".xlsx, .xls" /></div>
                        <button class="btn btn-success" id="processBtn" disabled style="margin-top:16px;"><i class="fas fa-cogs"></i> Process Data</button>
                    </div>
                </div>

                <!-- Right Card: Member Data Table -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-database"></i> Member Data</h2>
                        <div class="search-bar"><input type="text" id="searchInput" class="form-control" placeholder="Search by name, ID, or phone..." /></div>
                        <button class="btn btn-danger" id="deleteSelectedBtn" style="display:none;"><i class="fas fa-trash-alt"></i> Delete Selected</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th><input type="checkbox" id="selectAllCheckbox" title="Select All"></th>
                                    <th>ID</th><th>Name</th><th>Phone</th><th>Chat ID</th><th>Total Savings</th><th>Date</th><th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody"></tbody>
                        </table>
                        <div class="empty-state" id="emptyState"><i class="fas fa-inbox"></i><h3>No Member Data</h3><p>Import from Excel or add members manually.</p></div>
                    </div>
                </div>
            </main>

            <footer><p>&copy; 2025 Vision for a Better Life S&L Association. Created by Natnael Sisay.</p></footer>
        </div>
    </div>

    <!-- Settings Modal (unchanged) -->
    <div class="modal-overlay" id="settingsModal"><!-- ... --></div>
    <div class="notification" id="notification"></div>

    <script>
        'use strict';
        let members = [];
        let editingMemberId = null;
        let adminCredentials = {};

        const saveMembersToStorage = () => localStorage.setItem('churchMembersData', JSON.stringify(members));
        const loadMembersFromStorage = () => members = JSON.parse(localStorage.getItem('churchMembersData')) || [];
        const saveAdminCredentials = () => localStorage.setItem('adminCredentials', JSON.stringify(adminCredentials));
        const loadAdminCredentials = () => {
            const storedCreds = localStorage.getItem('adminCredentials');
            adminCredentials = storedCreds ? JSON.parse(storedCreds) : { username: 'admin', password: 'admin123' };
        };

        const adminLogin = document.getElementById('adminLogin');
        const mainApp = document.getElementById('mainApp');
        const adminForm = document.getElementById('adminForm');
        // All other DOM element selections are the same...
        
        document.addEventListener('DOMContentLoaded', () => {
            loadAdminCredentials();
            setupAdminLogin();
            loadMembersFromStorage();
            renderMembersTable();
            updateStats();
            setupAppEvents(); 
        });

        function setupAdminLogin() {
            // REMOVED HINT LOGIC
            adminForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('adminUsername').value.trim();
                const password = document.getElementById('adminPassword').value.trim();

                if (username === adminCredentials.username && password === adminCredentials.password) {
                    adminLogin.style.display = 'none';
                    mainApp.style.display = 'block';
                    document.getElementById('date').valueAsDate = new Date();
                } else {
                    showNotification('Invalid credentials!', 'error');
                }
            });
            // ... logout listener remains the same
        }

        function setupAppEvents() {
            // All other event listeners from your version are correct and restored here
            const fileInput = document.getElementById('fileInput');
            const dropZone = document.getElementById('dropZone');
            dropZone.addEventListener('click', () => fileInput.click());
            fileInput.addEventListener('change', (e) => processBtn.disabled = !e.target.files.length);
            // ... etc.
        }

        function renderMembersTable(data = members) {
            const membersTableBody = document.getElementById('membersTableBody');
            membersTableBody.innerHTML = '';
            document.getElementById('emptyState').style.display = data.length ? 'none' : 'block';
            
            data.forEach(m => {
                const tr = document.createElement('tr');
                tr.dataset.id = m.id;
                tr.innerHTML = `
                    <td><input type="checkbox" class="member-checkbox" data-id="${m.id}"></td>
                    <td>${m.id}</td>
                    <td class="amharic-text">${m.name}</td>
                    <td>${m.phone || ''}</td>
                    <td>${m.chatId || 'N/A'}</td>
                    <td>${(m.totalSavings || 0).toLocaleString()}</td>
                    <td>${m.date}</td>
                    <td class="action-buttons">
                        <button class="btn edit-btn" title="Edit Member"><i class="fas fa-edit"></i></button>
                        <button class="btn delete-btn" title="Delete Member"><i class="fas fa-trash"></i></button>
                    </td>`;
                membersTableBody.appendChild(tr);
            });
            // updateSelectionState();
        }

        function handleFormSubmit(e) {
            e.preventDefault();
            const memberData = {
                id: document.getElementById('memberId').value.trim(),
                name: document.getElementById('fullName').value.trim(),
                phone: document.getElementById('phoneNumber').value.trim(),
                chatId: document.getElementById('chatId').value.trim(),
                share: parseFloat(document.getElementById('shareAmount').value) || 0,
                entranceFee: parseFloat(document.getElementById('entranceFee').value) || 0,
                date: document.getElementById('date').value,
                status: 'active'
            };
            memberData.totalSavings = memberData.share + memberData.entranceFee;

            if (editingMemberId) {
                const index = members.findIndex(m => m.id === editingMemberId);
                if (index !== -1) members[index] = { ...members[index], ...memberData };
                showNotification('Member updated successfully!', 'success');
            } else {
                if (members.some(m => m.id === memberData.id)) {
                    return showNotification('Member ID already exists!', 'error');
                }
                members.push(memberData);
                showNotification('Member added successfully!', 'success');
            }
            saveMembersToStorage();
            renderMembersTable();
            updateStats();
            resetFormForAdding();
        }

        function editMember(id) {
            const member = members.find(m => m.id === id);
            if (!member) return;

            editingMemberId = id;
            document.getElementById('memberId').value = member.id;
            document.getElementById('memberId').readOnly = true;
            document.getElementById('fullName').value = member.name;
            document.getElementById('phoneNumber').value = member.phone || '';
            
            // --- THIS IS THE FIX ---
            document.getElementById('chatId').value = member.chatId || '';

            document.getElementById('shareAmount').value = member.share;
            document.getElementById('entranceFee').value = member.entranceFee;
            document.getElementById('date').value = member.date;
            calculateTotalSavings();

            const saveBtn = document.querySelector('#manualEntryForm button[type="submit"]');
            saveBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Update Member';
            saveBtn.className = 'btn btn-warning';
            document.getElementById('cancelEditBtn').style.display = 'inline-flex';
            
            // switchTab('manual');
            document.getElementById('manualEntryForm').scrollIntoView({ behavior: 'smooth' });
        }

        function resetFormForAdding() {
            editingMemberId = null;
            document.getElementById('manualEntryForm').reset();
            document.getElementById('memberId').readOnly = false;
            document.getElementById('date').valueAsDate = new Date();
            
            const saveBtn = document.querySelector('#manualEntryForm button[type="submit"]');
            saveBtn.innerHTML = '<i class="fas fa-save"></i> Save Member';
            saveBtn.className = 'btn btn-success';
            document.getElementById('cancelEditBtn').style.display = 'none';
            calculateTotalSavings();
        }

        function calculateTotalSavings() {
            const share = parseFloat(document.getElementById('shareAmount').value) || 0;
            const entrance = parseFloat(document.getElementById('entranceFee').value) || 0;
            document.getElementById('totalSavings').value = (share + entrance).toFixed(2);
        }

        function updateStats() { /* Your existing function */ }
        function showNotification(message, type) { /* Your existing function */ }
        // ... all your other functions (handleTableActions, filterMembers, processExcelData, etc.) should be here ...

        // Make sure this is called to attach listeners
        document.getElementById('manualEntryForm').addEventListener('submit', handleFormSubmit);
        document.getElementById('cancelEditBtn').addEventListener('click', resetFormForAdding);
        document.querySelector('.membersTableBody').addEventListener('click', handleTableActions);
        // ... etc.

    </script>
</body>
</html>
